<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="red.sukun1899.shishamo.repository.ViewRepository">
    <resultMap id="viewMap" type="red.sukun1899.shishamo.model.View" autoMapping="true">
        <id property="name" column="name"/>
        <collection property="columns" ofType="red.sukun1899.shishamo.model.Column" autoMapping="true"
                    columnPrefix="column_">
            <id column="name" property="name"/>
        </collection>
    </resultMap>

    <select id="select" resultMap="viewMap">
        SELECT
            viw.`table_name`      AS `name`,
            col.`column_name`     AS `column_name`,
            col.`column_type`     AS `column_type`,
            col.`column_default`  AS `column_defaultValue`,
            col.`is_nullable`     AS `column_nullable`,
            col.`column_comment`  AS `column_comment`
        FROM
            `information_schema`.`tables` viw
            INNER JOIN
            `information_schema`.`columns` col
                ON viw.`table_schema` = col.`table_schema` AND viw.`table_name` = col.`table_name`
        WHERE
            viw.`table_schema` = #{schemaName}
            AND
            viw.`table_type` = 'VIEW'
    </select>

    <select id="selectByName" resultMap="viewMap">
        SELECT
        viw.`table_name`      AS `name`,
        col.`column_name`     AS `column_name`,
        col.`column_type`     AS `column_type`,
        col.`column_default`  AS `column_defaultValue`,
        col.`is_nullable`     AS `column_nullable`,
        col.`column_comment`  AS `column_comment`
        FROM
        `information_schema`.`tables` viw
        INNER JOIN
        `information_schema`.`columns` col
        ON viw.`table_schema` = col.`table_schema` AND viw.`table_name` = col.`table_name`
        WHERE
        viw.`table_schema` = #{schemaName}
        AND
        viw.`table_type` = 'VIEW'
        AND
        viw.`table_name` = #{name}
    </select>
</mapper>
