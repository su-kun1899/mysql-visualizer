machine:
  timezone:
    Asia/Tokyo
  java:
    version: oraclejdk8
  environment:
    _JAVA_OPTIONS: "-Xms1024m -Xmx3072m"
general:
  artifacts:
    - "target/shishamo.jar"
database:
  post:
    - mysql -u root --execute "create database if not exists sample character set utf8"
dependencies:
  override:
    - mvn dependency:resolve
test:
  override:
    - mvn integration-test -Dspring.profiles.active=circleci -Dshishamo.embedded.mysql=false
    - mvn jacoco:report
  post:
    - mkdir -p $CIRCLE_ARTIFACTS/site/jacoco
    - mv target/site/jacoco/ $CIRCLE_ARTIFACTS/site/jacoco
    - bash <(curl -s https://codecov.io/bash) -t $CODECOV_TOKEN
